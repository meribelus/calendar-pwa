<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Orientation Safe Calendar</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#121212">

<style>
/* =====================
   RESPONSIVE ROOT FONT
===================== */
html {
  font-size: 14px;
}

@media (min-width: 600px) {
  html { font-size: 16px; }
}

@media (min-width: 1024px) {
  html { font-size: 18px; }
}

/* =====================
   THEME
===================== */
:root {
  --bg: #f4f4f4;
  --text: #000;
  --border: #ccc;
}

body.dark {
  --bg: #121212;
  --text: #fff;
  --border: #333;
}

/* =====================
   RESET
===================== */
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  height: 100%;
}

body {
  font-family: system-ui, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* =====================
   APP CONTAINER
===================== */
.app {
  height: 100dvh;
  width: 100vw;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

/* =====================
   TOP BAR
===================== */
.top-bar {
  display: flex;
  justify-content: flex-end;
}

#theme-toggle {
  font-size: 1rem;
  padding: 0.4rem 0.6rem;
  cursor: pointer;
}

/* =====================
   HEADER
===================== */
.header {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
}

.header h2 {
  margin: 0;
  text-align: center;
  font-size: 1.6rem;
}

button {
  font-size: 1rem;
  padding: 0.4rem 0.7rem;
  cursor: pointer;
}

/* =====================
   WEEKDAYS
===================== */
.weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
}

.weekdays div {
  text-align: center;
  padding: 0.4rem 0;
  font-size: 0.85rem;
  border: 1px solid var(--border);
}

/* =====================
   DAYS GRID
===================== */
.days-wrapper {
  flex: 1;
  display: flex;
  min-height: 0; /* ðŸ”¥ allows flex children to resize */
}

.days {
  flex: 1;
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  grid-auto-rows: 1fr;
  touch-action: pan-y;
}

.day {
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  cursor: pointer;
}

/* =====================
   DAY STATES
===================== */
.today {
  outline: 0.2rem solid orange;
  outline-offset: -0.2rem;
  font-weight: bold;
}

.note-red { background: #ffb3b3; }
.note-blue { background: #b3d9ff; }
.note-green { background: #b3ffcc; }
.note-yellow { background: #fff3b3; }

body.dark .note-red { background: #7a2b2b; }
body.dark .note-blue { background: #1e3a5f; }
body.dark .note-green { background: #1f5a3a; }
body.dark .note-yellow { background: #6b5c1f; }

/* =====================
   LANDSCAPE OPTIMIZATION
===================== */
@media (orientation: landscape) {
  .header h2 {
    font-size: 1.3rem;
  }

  .weekdays div {
    font-size: 0.75rem;
    padding: 0.25rem 0;
  }

  .day {
    font-size: 0.9rem;
  }
}

/* =====================
   MODAL
===================== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
}

.hidden { display: none; }

.modal-content {
  background: var(--bg);
  color: var(--text);
  width: min(90vw, 420px);
  padding: 1rem;
  border-radius: 0.6rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
}

textarea, select {
  font-size: 1rem;
  padding: 0.4rem;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 0.5rem;
}
</style>
</head>

<body>

<div class="app">

  <div class="top-bar">
    <button id="theme-toggle">ðŸŒ™</button>
  </div>

  <div class="header">
    <button id="prev">â€¹</button>
    <h2 id="title"></h2>
    <button id="next">â€º</button>
  </div>

  <div class="weekdays">
    <div>Sun</div><div>Mon</div><div>Tue</div>
    <div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
  </div>

  <div class="days-wrapper">
    <div class="days" id="days"></div>
  </div>
</div>

<!-- MODAL -->
<div class="modal hidden" id="modal">
  <div class="modal-content">
    <h3 id="modal-title"></h3>
    <textarea id="note" rows="5" placeholder="Write a note..."></textarea>
    <select id="color">
      <option value="">No label</option>
      <option value="red">Urgent</option>
      <option value="blue">Work</option>
      <option value="green">Personal</option>
      <option value="yellow">Reminder</option>
    </select>
    <div class="modal-actions">
      <button id="save">Save</button>
      <button id="cancel">Cancel</button>
    </div>
  </div>
</div>

<script>
const state = {
  date: new Date(),
  notes: JSON.parse(localStorage.getItem('notes')) || {},
  selected: null
};

const MONTHS = [
  'January','February','March','April','May','June',
  'July','August','September','October','November','December'
];

const daysEl = document.getElementById('days');
const titleEl = document.getElementById('title');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const noteInput = document.getElementById('note');
const colorInput = document.getElementById('color');

/* THEME */
document.body.classList.toggle('dark', localStorage.getItem('theme') === 'dark');
document.getElementById('theme-toggle').onclick = () => {
  document.body.classList.toggle('dark');
  localStorage.setItem('theme',
    document.body.classList.contains('dark') ? 'dark' : 'light');
};

/* RENDER */
function render() {
  daysEl.innerHTML = '';
  const y = state.date.getFullYear();
  const m = state.date.getMonth();
  titleEl.textContent = `${MONTHS[m]} ${y}`;

  const first = new Date(y, m, 1).getDay();
  const total = new Date(y, m + 1, 0).getDate();

  for (let i = 0; i < first; i++) {
    daysEl.appendChild(document.createElement('div'));
  }

  for (let d = 1; d <= total; d++) {
    const cell = document.createElement('div');
    cell.className = 'day';
    cell.textContent = d;

    const key = `${y}-${m}-${d}`;
    if (state.notes[key]?.color) {
      cell.classList.add(`note-${state.notes[key].color}`);
    }

    const t = new Date();
    if (d === t.getDate() && m === t.getMonth() && y === t.getFullYear()) {
      cell.classList.add('today');
    }

    cell.onclick = () => openModal(key, d);
    daysEl.appendChild(cell);
  }
}

/* MODAL */
function openModal(key, day) {
  state.selected = key;
  modalTitle.textContent = `${MONTHS[state.date.getMonth()]} ${day}`;
  noteInput.value = state.notes[key]?.text || '';
  colorInput.value = state.notes[key]?.color || '';
  modal.classList.remove('hidden');
}

document.getElementById('save').onclick = () => {
  const text = noteInput.value.trim();
  if (!text) delete state.notes[state.selected];
  else state.notes[state.selected] = { text, color: colorInput.value };
  localStorage.setItem('notes', JSON.stringify(state.notes));
  modal.classList.add('hidden');
  render();
};

document.getElementById('cancel').onclick = () => modal.classList.add('hidden');
modal.onclick = e => e.target === modal && modal.classList.add('hidden');

/* NAV */
document.getElementById('prev').onclick = () => {
  state.date.setMonth(state.date.getMonth() - 1);
  render();
};

document.getElementById('next').onclick = () => {
  state.date.setMonth(state.date.getMonth() + 1);
  render();
};

/* SWIPE */
let startX = 0;
daysEl.addEventListener('touchstart', e => {
  startX = e.touches[0].clientX;
}, { passive: true });

daysEl.addEventListener('touchend', e => {
  const diff = e.changedTouches[0].clientX - startX;
  if (Math.abs(diff) > 50) {
    state.date.setMonth(state.date.getMonth() + (diff < 0 ? 1 : -1));
    render();
  }
});

render();
</script>
  <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js")
      .then(() => console.log("Service Worker registered"))
      .catch(err => console.error("SW failed:", err));
  });
}
</script>


</body>
</html>
